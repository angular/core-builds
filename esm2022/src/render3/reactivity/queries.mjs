/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
import { consumerMarkDirty, producerAccessed, producerUpdateValueVersion, REACTIVE_NODE, SIGNAL } from '@angular/core/primitives/signals';
import { createContentQueryInternal, createViewQueryInternal, loadQueryInternal, queryRefreshInternal } from '../query';
import { getLView } from '../state';
// Note: Using an IIFE here to ensure that the spread assignment is not considered
// a side-effect, ending up preserving `COMPUTED_NODE` and `REACTIVE_NODE`.
// TODO: remove when https://github.com/evanw/esbuild/issues/3392 is resolved.
export const QUERY_SIGNAL_NODE = /* @__PURE__ */ (() => {
    return {
        ...REACTIVE_NODE,
        // Base reactive node.overrides
        producerMustRecompute: (node) => {
            return !!node._queryList?.dirty;
        },
        producerRecomputeValue: (node) => {
            // The current value is stale. Check whether we need to produce a new one.
            // TODO: assert: I've got both the lView and queryIndex stored
            if (queryRefreshInternal(node._lView, node._queryIndex)) {
                node.version++;
            }
        },
        // Query-specific implementations.
        bindToQuery: (node, queryIndex) => {
            // TODO: assert: should bind only once, make sure it is not re-assigned again
            node._lView = getLView();
            node._queryIndex = queryIndex;
            node._queryList = loadQueryInternal(node._lView, queryIndex);
            node._queryList.onDirty(() => {
                console.error('Dirty');
                // Mark this producer as dirty and notify live consumer about the potential change. Note
                // that the onDirty callback will fire only on the initial dirty marking (that is,
                // subsequent dirty notifications are not fired- until the QueryList becomes clean again).
                consumerMarkDirty(node);
            });
        },
        // TODO(signals): Unsubscribe - destroy?
    };
})();
function querySignalFnFirst() {
    const node = Object.create(QUERY_SIGNAL_NODE);
    function signalFn() {
        // Check if the value needs updating before returning it.
        producerUpdateValueVersion(node);
        // Mark this producer as accessed.
        producerAccessed(node);
        return node._queryList?.first;
    }
    signalFn[SIGNAL] = node;
    return signalFn;
}
function querySignalFnAll() {
    const node = Object.create(QUERY_SIGNAL_NODE);
    function signalFn() {
        // Check if the value needs updating before returning it.
        producerUpdateValueVersion(node);
        // Mark this producer as accessed.
        producerAccessed(node);
        return node._queryList?.toArray() ?? [];
    }
    signalFn[SIGNAL] = node;
    return signalFn;
}
// THINK: code duplication for predicate, flags etc.? Or would it be extracted by the compiler?
export function ɵɵviewQueryCreate(target, predicate, flags, read) {
    const lView = getLView();
    const reactiveQueryNode = target[SIGNAL];
    reactiveQueryNode.bindToQuery(reactiveQueryNode, createViewQueryInternal(lView, predicate, flags, read));
}
// Q: assuming that the return type must be similar to InputSignal, with the write ability? (this is
// needed only from the generated code so maybe not?)
export function viewChild(selector, opts) {
    return querySignalFnFirst();
}
export function viewChildren(selector, opts) {
    // Q: by returning a signal we are effectively "dropping" QueryList from the public API. Is there
    // anything valuable there that we would be losing?
    return querySignalFnAll();
}
export function ɵɵcontentQueryCreate(target, dirIndex, predicate, flags, read) {
    const lView = getLView();
    const reactiveQueryNode = target[SIGNAL];
    // Q: why do we need the directive index?
    reactiveQueryNode.bindToQuery(reactiveQueryNode, createContentQueryInternal(lView, dirIndex, predicate, flags, read));
}
export function contentChild(selector, opts) {
    return querySignalFnFirst();
}
export function contentChildren(selector, opts) {
    // Q: by returning a signal we are effectively "dropping" QueryList from the public API. Is there
    // anything valuable there that we would be loosing?
    return querySignalFnAll();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlcmllcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL2NvcmUvc3JjL3JlbmRlcjMvcmVhY3Rpdml0eS9xdWVyaWVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7R0FNRztBQUVILE9BQU8sRUFBQyxpQkFBaUIsRUFBRSxnQkFBZ0IsRUFBRSwwQkFBMEIsRUFBRSxhQUFhLEVBQWdCLE1BQU0sRUFBQyxNQUFNLGtDQUFrQyxDQUFDO0FBTXRKLE9BQU8sRUFBQywwQkFBMEIsRUFBRSx1QkFBdUIsRUFBRSxpQkFBaUIsRUFBRSxvQkFBb0IsRUFBQyxNQUFNLFVBQVUsQ0FBQztBQUN0SCxPQUFPLEVBQUMsUUFBUSxFQUFDLE1BQU0sVUFBVSxDQUFDO0FBWWxDLGtGQUFrRjtBQUNsRiwyRUFBMkU7QUFDM0UsOEVBQThFO0FBQzlFLE1BQU0sQ0FBQyxNQUFNLGlCQUFpQixHQUE2QixlQUFlLENBQUMsQ0FBQyxHQUFHLEVBQUU7SUFDL0UsT0FBTztRQUNMLEdBQUcsYUFBYTtRQUVoQiwrQkFBK0I7UUFDL0IscUJBQXFCLEVBQUUsQ0FBQyxJQUE4QixFQUFFLEVBQUU7WUFDeEQsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUM7UUFDbEMsQ0FBQztRQUVELHNCQUFzQixFQUFFLENBQUMsSUFBOEIsRUFBRSxFQUFFO1lBQ3pELDBFQUEwRTtZQUMxRSw4REFBOEQ7WUFDOUQsSUFBSSxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsTUFBTyxFQUFFLElBQUksQ0FBQyxXQUFZLENBQUMsRUFBRTtnQkFDekQsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO2FBQ2hCO1FBQ0gsQ0FBQztRQUVELGtDQUFrQztRQUNsQyxXQUFXLEVBQUUsQ0FBQyxJQUE4QixFQUFFLFVBQWtCLEVBQUUsRUFBRTtZQUNsRSw2RUFBNkU7WUFDN0UsSUFBSSxDQUFDLE1BQU0sR0FBRyxR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QUFNLFVBQVUsWUFBWSxDQUN4QixRQUFpQyxFQUNqQyxJQUE0RDtJQUM5RCxPQUFPLGtCQUFrQixFQUFFLENBQUM7QUFDOUIsQ0FBQztBQUVELE1BQU0sVUFBVSxlQUFlLENBQzNCLFFBQWlDLEVBQ2pDLElBQTZFO0lBQy9FLGlHQUFpRztJQUNqRyxvREFBb0Q7SUFDcEQsT0FBTyxnQkFBZ0IsRUFBRSxDQUFDO0FBQzVCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgR29vZ2xlIExMQyBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGFuIE1JVC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4gKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vYW5ndWxhci5pby9saWNlbnNlXG4gKi9cblxuaW1wb3J0IHtjb25zdW1lck1hcmtEaXJ0eSwgcHJvZHVjZXJBY2Nlc3NlZCwgcHJvZHVjZXJVcGRhdGVWYWx1ZVZlcnNpb24sIFJFQUNUSVZFX05PREUsIFJlYWN0aXZlTm9kZSwgU0lHTkFMfSBmcm9tICdAYW5ndWxhci9jb3JlL3ByaW1pdGl2ZXMvc2lnbmFscyc7XG5cbmltcG9ydCB7UHJvdmlkZXJUb2tlbn0gZnJvbSAnLi4vLi4vZGkvcHJvdmlkZXJfdG9rZW4nO1xuaW1wb3J0IHtRdWVyeUxpc3R9IGZyb20gJy4uLy4uL2xpbmtlcic7XG5pbXBvcnQge1F1ZXJ5RmxhZ3N9IGZyb20gJy4uL2ludGVyZmFjZXMvcXVlcnknO1xuaW1wb3J0IHtMVmlld30gZnJvbSAnLi4vaW50ZXJmYWNlcy92aWV3JztcbmltcG9ydCB7Y3JlYXRlQ29udGVudFF1ZXJ5SW50ZXJuYWwsIGNyZWF0ZVZpZXdRdWVyeUludGVybmFsLCBsb2FkUXVlcnlJbnRlcm5hbCwgcXVlcnlSZWZyZXNoSW50ZXJuYWx9IGZyb20gJy4uL3F1ZXJ5JztcbmltcG9ydCB7Z2V0TFZpZXd9IGZyb20gJy4uL3N0YXRlJztcblxuaW1wb3J0IHtTaWduYWx9IGZyb20gJy4vYXBpJztcblxuZXhwb3J0IGludGVyZmFjZSBRdWVyeVNpZ25hbE5vZGU8VD4gZXh0ZW5kcyBSZWFjdGl2ZU5vZGUge1xuICBfbFZpZXc/OiBMVmlldztcbiAgX3F1ZXJ5SW5kZXg/OiBudW1iZXI7XG4gIF9xdWVyeUxpc3Q/OiBRdWVyeUxpc3Q8VD47XG5cbiAgYmluZFRvUXVlcnkobm9kZTogdGhpcywgcXVlcnlJbmRleDogbnVtYmVyKTogdm9pZDtcbn1cblxuLy8gTm90ZTogVXNpbmcgYW4gSUlGRSBoZXJlIHRvIGVuc3VyZSB0aGF0IHRoZSBzcHJlYWQgYXNzaWdubWVudCBpcyBub3QgY29uc2lkZXJlZFxuLy8gYSBzaWRlLWVmZmVjdCwgZW5kaW5nIHVwIHByZXNlcnZpbmcgYENPTVBVVEVEX05PREVgIGFuZCBgUkVBQ1RJVkVfTk9ERWAuXG4vLyBUT0RPOiByZW1vdmUgd2hlbiBodHRwczovL2dpdGh1Yi5jb20vZXZhbncvZXNidWlsZC9pc3N1ZXMvMzM5MiBpcyByZXNvbHZlZC5cbmV4cG9ydCBjb25zdCBRVUVSWV9TSUdOQUxfTk9ERTogUXVlcnlTaWduYWxOb2RlPHVua25vd24+ID0gLyogQF9fUFVSRV9fICovICgoKSA9PiB7XG4gIHJldHVybiB7XG4gICAgLi4uUkVBQ1RJVkVfTk9ERSxcblxuICAgIC8vIEJhc2UgcmVhY3RpdmUgbm9kZS5vdmVycmlkZXNcbiAgICBwcm9kdWNlck11c3RSZWNvbXB1dGU6IChub2RlOiBRdWVyeVNpZ25hbE5vZGU8dW5rbm93bj4pID0+IHtcbiAgICAgIHJldHVybiAhIW5vZGUuX3F1ZXJ5TGlzdD8uZGlydHk7XG4gICAgfSxcblxuICAgIHByb2R1Y2VyUmVjb21wdXRlVmFsdWU6IChub2RlOiBRdWVyeVNpZ25hbE5vZGU8dW5rbm93bj4pID0+IHtcbiAgICAgIC8vIFRoZSBjdXJyZW50IHZhbHVlIGlzIHN0YWxlLiBDaGVjayB3aGV0aGVyIHdlIG5lZWQgdG8gcHJvZHVjZSBhIG5ldyBvbmUuXG4gICAgICAvLyBUT0RPOiBhc3NlcnQ6IEkndmUgZ290IGJvdGggdGhlIGxWaWV3IGFuZCBxdWVyeUluZGV4IHN0b3JlZFxuICAgICAgaWYgKHF1ZXJ5UmVmcmVzaEludGVybmFsKG5vZGUuX2xWaWV3ISwgbm9kZS5fcXVlcnlJbmRleCEpKSB7XG4gICAgICAgIG5vZGUudmVyc2lvbisrO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyBRdWVyeS1zcGVjaWZpYyBpbXBsZW1lbnRhdGlvbnMuXG4gICAgYmluZFRvUXVlcnk6IChub2RlOiBRdWVyeVNpZ25hbE5vZGU8dW5rbm93bj4sIHF1ZXJ5SW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgLy8gVE9ETzogYXNzZXJ0OiBzaG91bGQgYmluZCBvbmx5IG9uY2UsIG1ha2Ugc3VyZSBpdCBpcyBub3QgcmUtYXNzaWduZWQgYWdhaW5cbiAgICAgIG5vZGUuX2xWaWV3ID0gZ2V0TFZpZXcoKTtcbiAgICAgIG5vZGUuX3F1ZXJ5SW5kZXggPSBxdWVyeUluZGV4O1xuICAgICAgbm9kZS5fcXVlcnlMaXN0ID0gbG9hZFF1ZXJ5SW50ZXJuYWwobm9kZS5fbFZpZXcsIHF1ZXJ5SW5kZXgpO1xuXG4gICAgICBub2RlLl9xdWVyeUxpc3Qub25EaXJ0eSgoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0RpcnR5Jyk7XG4gICAgICAgIC8vIE1hcmsgdGhpcyBwcm9kdWNlciBhcyBkaXJ0eSBhbmQgbm90aWZ5IGxpdmUgY29uc3VtZXIgYWJvdXQgdGhlIHBvdGVudGlhbCBjaGFuZ2UuIE5vdGVcbiAgICAgICAgLy8gdGhhdCB0aGUgb25EaXJ0eSBjYWxsYmFjayB3aWxsIGZpcmUgb25seSBvbiB0aGUgaW5pdGlhbCBkaXJ0eSBtYXJraW5nICh0aGF0IGlzLFxuICAgICAgICAvLyBzdWJzZXF1ZW50IGRpcnR5IG5vdGlmaWNhdGlvbnMgYXJlIG5vdCBmaXJlZC0gdW50aWwgdGhlIFF1ZXJ5TGlzdCBiZWNvbWVzIGNsZWFuIGFnYWluKS5cbiAgICAgICAgY29uc3VtZXJNYXJrRGlydHkobm9kZSk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy8gVE9ETyhzaWduYWxzKTogVW5zdWJzY3JpYmUgLSBkZXN0cm95P1xuICB9O1xufSkoKTtcblxuZnVuY3Rpb24gcXVlcnlTaWduYWxGbkZpcnN0PFQ+KCk6IFNpZ25hbDxUfHVuZGVmaW5lZD4ge1xuICBjb25zdCBub2RlOiBRdWVyeVNpZ25hbE5vZGU8VD4gPSBPYmplY3QuY3JlYXRlKFFVRVJZX1NJR05BTF9OT0RFKTtcblxuICBmdW5jdGlvbiBzaWduYWxGbigpIHtcbiAgICAvLyBDaGVjayBpZiB0aGUgdmFsdWUgbmVlZHMgdXBkYXRpbmcgYmVmb3JlIHJldHVybmluZyBpdC5cbiAgICBwcm9kdWNlclVwZGF0ZVZhbHVlVmVyc2lvbihub2RlKTtcblxuICAgIC8vIE1hcmsgdGhpcyBwcm9kdWNlciBhcyBhY2Nlc3NlZC5cbiAgICBwcm9kdWNlckFjY2Vzc2VkKG5vZGUpO1xuXG4gICAgcmV0dXJuIG5vZGUuX3F1ZXJ5TGlzdD8uZmlyc3Q7XG4gIH1cbiAgKHNpZ25hbEZuIGFzIGFueSlbU0lHTkFMXSA9IG5vZGU7XG5cbiAgcmV0dXJuIHNpZ25hbEZuIGFzIFNpZ25hbDxUfHVuZGVmaW5lZD47XG59XG5cbmZ1bmN0aW9uIHF1ZXJ5U2lnbmFsRm5BbGw8VD4oKTogU2lnbmFsPFRbXT4ge1xuICBjb25zdCBub2RlOiBRdWVyeVNpZ25hbE5vZGU8VD4gPSBPYmplY3QuY3JlYXRlKFFVRVJZX1NJR05BTF9OT0RFKTtcblxuICBmdW5jdGlvbiBzaWduYWxGbigpIHtcbiAgICAvLyBDaGVjayBpZiB0aGUgdmFsdWUgbmVlZHMgdXBkYXRpbmcgYmVmb3JlIHJldHVybmluZyBpdC5cbiAgICBwcm9kdWNlclVwZGF0ZVZhbHVlVmVyc2lvbihub2RlKTtcblxuICAgIC8vIE1hcmsgdGhpcyBwcm9kdWNlciBhcyBhY2Nlc3NlZC5cbiAgICBwcm9kdWNlckFjY2Vzc2VkKG5vZGUpO1xuXG4gICAgcmV0dXJuIG5vZGUuX3F1ZXJ5TGlzdD8udG9BcnJheSgpID8/IFtdO1xuICB9XG4gIChzaWduYWxGbiBhcyBhbnkpW1NJR05BTF0gPSBub2RlO1xuXG4gIHJldHVybiBzaWduYWxGbiBhcyBTaWduYWw8VFtdPjtcbn1cblxuXG4vLyBUSElOSzogY29kZSBkdXBsaWNhdGlvbiBmb3IgcHJlZGljYXRlLCBmbGFncyBldGMuPyBPciB3b3VsZCBpdCBiZSBleHRyYWN0ZWQgYnkgdGhlIGNvbXBpbGVyP1xuZXhwb3J0IGZ1bmN0aW9uIMm1ybV2aWV3UXVlcnlDcmVhdGU8VD4oXG4gICAgdGFyZ2V0OiBTaWduYWw8VHx1bmRlZmluZWQ+LCBwcmVkaWNhdGU6IFByb3ZpZGVyVG9rZW48VD58c3RyaW5nW10sIGZsYWdzOiBRdWVyeUZsYWdzLFxuICAgIHJlYWQ/OiBhbnkpIHtcbiAgY29uc3QgbFZpZXcgPSBnZXRMVmlldygpO1xuICBjb25zdCByZWFjdGl2ZVF1ZXJ5Tm9kZSA9IHRhcmdldFtTSUdOQUxdIGFzIFF1ZXJ5U2lnbmFsTm9kZTx1bmtub3duPjtcbiAgcmVhY3RpdmVRdWVyeU5vZGUuYmluZFRvUXVlcnkoXG4gICAgICByZWFjdGl2ZVF1ZXJ5Tm9kZSwgY3JlYXRlVmlld1F1ZXJ5SW50ZXJuYWw8VD4obFZpZXcsIHByZWRpY2F0ZSwgZmxhZ3MsIHJlYWQpKTtcbn1cblxuLy8gUTogYXNzdW1pbmcgdGhhdCB0aGUgcmV0dXJuIHR5cGUgbXVzdCBiZSBzaW1pbGFyIHRvIElucHV0U2lnbmFsLCB3aXRoIHRoZSB3cml0ZSBhYmlsaXR5PyAodGhpcyBpc1xuLy8gbmVlZGVkIG9ubHkgZnJvbSB0aGUgZ2VuZXJhdGVkIGNvZGUgc28gbWF5YmUgbm90PylcbmV4cG9ydCBmdW5jdGlvbiB2aWV3Q2hpbGQ8VD4oXG4gICAgc2VsZWN0b3I6IFByb3ZpZGVyVG9rZW48VD58c3RyaW5nLCBvcHRzPzoge3JlYWQ/OiBhbnksIHN0YXRpYz86IGJvb2xlYW59KTogU2lnbmFsPFR8dW5kZWZpbmVkPiB7XG4gIHJldHVybiBxdWVyeVNpZ25hbEZuRmlyc3QoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZpZXdDaGlsZHJlbjxUPihcbiAgICBzZWxlY3RvcjogUHJvdmlkZXJUb2tlbjxUPnxzdHJpbmcsXG4gICAgb3B0cz86IHtyZWFkPzogYW55LCBlbWl0RGlzdGluY3RDaGFuZ2VzT25seT86IGJvb2xlYW59KTogU2lnbmFsPFRbXT4ge1xuICAvLyBROiBieSByZXR1cm5pbmcgYSBzaWduYWwgd2UgYXJlIGVmZmVjdGl2ZWx5IFwiZHJvcHBpbmdcIiBRdWVyeUxpc3QgZnJvbSB0aGUgcHVibGljIEFQSS4gSXMgdGhlcmVcbiAgLy8gYW55dGhpbmcgdmFsdWFibGUgdGhlcmUgdGhhdCB3ZSB3b3VsZCBiZSBsb3Npbmc/XG4gIHJldHVybiBxdWVyeVNpZ25hbEZuQWxsKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiDJtcm1Y29udGVudFF1ZXJ5Q3JlYXRlPFQ+KFxuICAgIHRhcmdldDogU2lnbmFsPFR8dW5kZWZpbmVkPiwgZGlySW5kZXg6IG51bWJlciwgcHJlZGljYXRlOiBQcm92aWRlclRva2VuPFQ+fHN0cmluZ1tdLFxuICAgIGZsYWdzOiBRdWVyeUZsYWdzLCByZWFkPzogYW55KSB7XG4gIGNvbnN0IGxWaWV3ID0gZ2V0TFZpZXcoKTtcbiAgY29uc3QgcmVhY3RpdmVRdWVyeU5vZGUgPSB0YXJnZXRbU0lHTkFMXSBhcyBRdWVyeVNpZ25hbE5vZGU8dW5rbm93bj47XG4gIC8vIFE6IHdoeSBkbyB3ZSBuZWVkIHRoZSBkaXJlY3RpdmUgaW5kZXg/XG4gIHJlYWN0aXZlUXVlcnlOb2RlLmJpbmRUb1F1ZXJ5KFxuICAgICAgcmVhY3RpdmVRdWVyeU5vZGUsIGNyZWF0ZUNvbnRlbnRRdWVyeUludGVybmFsPFQ+KGxWaWV3LCBkaXJJbmRleCwgcHJlZGljYXRlLCBmbGFncywgcmVhZCkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29udGVudENoaWxkPFQ+KFxuICAgIHNlbGVjdG9yOiBQcm92aWRlclRva2VuPFQ+fHN0cmluZyxcbiAgICBvcHRzPzoge2Rlc2NlbmRhbnRzPzogYm9vbGVhbiwgcmVhZD86IGFueSwgc3RhdGljPzogYm9vbGVhbn0pOiBTaWduYWw8VHx1bmRlZmluZWQ+IHtcbiAgcmV0dXJuIHF1ZXJ5U2lnbmFsRm5GaXJzdCgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29udGVudENoaWxkcmVuPFQ+KFxuICAgIHNlbGVjdG9yOiBQcm92aWRlclRva2VuPFQ+fHN0cmluZyxcbiAgICBvcHRzPzoge2Rlc2NlbmRhbnRzPzogYm9vbGVhbiwgcmVhZD86IGFueSwgZW1pdERpc3RpbmN0Q2hhbmdlc09ubHk/OiBib29sZWFufSk6IFNpZ25hbDxUW10+IHtcbiAgLy8gUTogYnkgcmV0dXJuaW5nIGEgc2lnbmFsIHdlIGFyZSBlZmZlY3RpdmVseSBcImRyb3BwaW5nXCIgUXVlcnlMaXN0IGZyb20gdGhlIHB1YmxpYyBBUEkuIElzIHRoZXJlXG4gIC8vIGFueXRoaW5nIHZhbHVhYmxlIHRoZXJlIHRoYXQgd2Ugd291bGQgYmUgbG9vc2luZz9cbiAgcmV0dXJuIHF1ZXJ5U2lnbmFsRm5BbGwoKTtcbn1cbiJdfQ==